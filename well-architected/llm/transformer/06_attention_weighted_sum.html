<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ³¨æ„åŠ›åŠ æƒæ±‚å’Œè¯¦è§£</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);
            color: #333;
            padding: 20px;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }
        
        h1 {
            text-align: center;
            color: #ef6c00;
            margin-bottom: 15px;
            font-size: 2.5em;
        }
        
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 40px;
            font-size: 1.1em;
        }
        
        .section {
            margin-bottom: 50px;
        }
        
        .section-title {
            font-size: 1.8em;
            color: #ef6c00;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #ffcc80;
        }
        
        .content-text {
            color: #555;
            font-size: 1.05em;
            line-height: 1.8;
            margin-bottom: 20px;
        }
        
        .highlight {
            color: #ef6c00;
            font-weight: bold;
            background: #fff3e0;
            padding: 2px 6px;
            border-radius: 3px;
        }
        
        /* åŠ æƒæ±‚å’Œå¯è§†åŒ– */
        .weighted-sum-demo {
            display: flex;
            flex-direction: column;
            gap: 30px;
            margin: 40px 0;
            padding: 30px;
            background: linear-gradient(135deg, #fff3e0, #ffe0b2);
            border-radius: 15px;
        }
        
        .weight-value-pair {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
        }
        
        .weight-box, .value-box, .result-box {
            background: white;
            padding: 20px 30px;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .weight-box {
            border: 3px solid #42a5f5;
        }
        
        .value-box {
            border: 3px solid #66bb6a;
        }
        
        .result-box {
            border: 3px solid #ef6c00;
        }
        
        .box-label {
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 1.1em;
        }
        
        .box-value {
            font-family: 'Courier New', monospace;
            font-size: 1.2em;
            color: #333;
        }
        
        .operator-symbol {
            font-size: 2em;
            color: #ef6c00;
            font-weight: bold;
        }
        
        /* å‘é‡å¯è§†åŒ– */
        .vector-visual {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .vector-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }
        
        .vector-label {
            color: #ef6c00;
            font-weight: bold;
            text-align: center;
            margin-bottom: 15px;
        }
        
        .vector-grid {
            display: grid;
            grid-template-columns: repeat(4, 45px);
            gap: 5px;
            margin: 10px auto;
            width: fit-content;
        }
        
        .vector-cell {
            width: 45px;
            height: 45px;
            background: linear-gradient(135deg, #ff9800, #ef6c00);
            color: white;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.85em;
            animation: cellPop 0.5s ease-out;
        }
        
        @keyframes cellPop {
            0% { transform: scale(0); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        /* å…¬å¼æ¡† */
        .formula-box {
            background: linear-gradient(135deg, #fff3e0, #ffe0b2);
            border-left: 5px solid #ef6c00;
            padding: 25px;
            margin: 25px 0;
            border-radius: 8px;
        }
        
        .formula {
            font-size: 1.4em;
            color: #ef6c00;
            text-align: center;
            font-family: 'Courier New', monospace;
            margin: 15px 0;
            font-weight: bold;
        }
        
        /* è®¡ç®—æ­¥éª¤ */
        .calculation-steps {
            background: #e8f5e9;
            border: 3px solid #66bb6a;
            border-radius: 15px;
            padding: 30px;
            margin: 30px 0;
        }
        
        .calc-header {
            color: #2e7d32;
            font-size: 1.4em;
            font-weight: bold;
            text-align: center;
            margin-bottom: 25px;
        }
        
        .calc-step {
            background: white;
            padding: 20px;
            margin: 15px 0;
            border-radius: 8px;
            border-left: 4px solid #66bb6a;
        }
        
        .step-title {
            color: #2e7d32;
            font-weight: bold;
            font-size: 1.1em;
            margin-bottom: 10px;
        }
        
        .step-content {
            color: #555;
            line-height: 1.8;
        }
        
        /* å®Œæ•´æµç¨‹å›¾ */
        .process-flow {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin: 30px 0;
            padding: 25px;
            background: #f5f5f5;
            border-radius: 10px;
        }
        
        .flow-step {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border-left: 5px solid #ef6c00;
            transition: all 0.3s;
        }
        
        .flow-step:hover {
            transform: translateX(10px);
            box-shadow: 0 5px 15px rgba(239, 108, 0, 0.3);
        }
        
        .flow-number {
            display: inline-block;
            width: 35px;
            height: 35px;
            background: linear-gradient(135deg, #ff9800, #ef6c00);
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 35px;
            font-weight: bold;
            margin-right: 15px;
        }
        
        .flow-title {
            display: inline-block;
            color: #ef6c00;
            font-weight: bold;
            font-size: 1.1em;
        }
        
        .flow-desc {
            margin-top: 10px;
            margin-left: 50px;
            color: #666;
            line-height: 1.6;
        }
        
        /* å¯¹æ¯”è¡¨æ ¼ */
        .comparison-table {
            width: 100%;
            margin: 30px 0;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }
        
        .comparison-table th {
            background: linear-gradient(135deg, #ff9800, #ef6c00);
            color: white;
            padding: 15px;
            font-weight: bold;
            text-align: left;
        }
        
        .comparison-table td {
            padding: 15px;
            border-bottom: 1px solid #e0e0e0;
            color: #555;
        }
        
        .comparison-table tr:hover {
            background: #fff3e0;
        }
        
        /* æç¤ºæ¡† */
        .tip-box {
            background: #e3f2fd;
            border-left: 5px solid #2196f3;
            padding: 20px;
            margin: 25px 0;
            border-radius: 8px;
        }
        
        .tip-title {
            color: #1565c0;
            font-weight: bold;
            font-size: 1.2em;
            margin-bottom: 10px;
        }
        
        .tip-content {
            color: #555;
            line-height: 1.8;
        }
        
        /* ä»£ç å— */
        .code-block {
            background: #263238;
            color: #aed581;
            padding: 25px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            margin: 25px 0;
            overflow-x: auto;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        /* å“åº”å¼ */
        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }
            
            h1 {
                font-size: 2em;
            }
            
            .weight-value-pair {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>âš–ï¸ æ³¨æ„åŠ›åŠ æƒæ±‚å’Œè¯¦è§£</h1>
        <p class="subtitle">Output = Attention_Weights Ã— Value</p>
        
        <!-- 1. åŸºæœ¬æ¦‚å¿µ -->
        <div class="section">
            <h2 class="section-title">ä¸€ã€ä»€ä¹ˆæ˜¯åŠ æƒæ±‚å’Œ</h2>
            <p class="content-text">
                åŠ æƒæ±‚å’Œæ˜¯è‡ªæ³¨æ„åŠ›æœºåˆ¶çš„<span class="highlight">æœ€åä¸€æ­¥</span>ï¼Œ
                ä½¿ç”¨Softmaxå¾—åˆ°çš„æ³¨æ„åŠ›æƒé‡ï¼Œå¯¹ValueçŸ©é˜µè¿›è¡Œ<span class="highlight">åŠ æƒå¹³å‡</span>ï¼Œ
                å¾—åˆ°èåˆäº†ä¸Šä¸‹æ–‡ä¿¡æ¯çš„æ–°å‘é‡ã€‚
            </p>
            
            <div class="tip-box">
                <div class="tip-title">ğŸ’¡ ç›´è§‚ç†è§£</div>
                <div class="tip-content">
                    <strong>ç±»æ¯”ï¼š</strong>å¬å–å¤šä½ä¸“å®¶æ„è§<br>
                    â€¢ <strong>Valueï¼š</strong>æ¯ä½ä¸“å®¶çš„è§‚ç‚¹å†…å®¹<br>
                    â€¢ <strong>æƒé‡ï¼š</strong>å¯¹æ¯ä½ä¸“å®¶çš„ä¿¡ä»»åº¦<br>
                    â€¢ <strong>åŠ æƒæ±‚å’Œï¼š</strong>æ ¹æ®ä¿¡ä»»åº¦ç»¼åˆå„ä¸“å®¶æ„è§<br>
                    <br>
                    ä¿¡ä»»åº¦è¶Šé«˜çš„ä¸“å®¶ï¼Œå…¶è§‚ç‚¹åœ¨æœ€ç»ˆå†³ç­–ä¸­å æ¯”è¶Šå¤§
                </div>
            </tip-box>
        </div>
        
        <!-- 2. è®¡ç®—å…¬å¼ -->
        <div class="section">
            <h2 class="section-title">äºŒã€åŠ æƒæ±‚å’Œå…¬å¼</h2>
            
            <div class="formula-box">
                <div class="formula">Output = Attention_Weights Ã— Value</div>
                <p style="color: #666; text-align: center; margin-top: 20px;">
                    â€¢ Attention_Weights: (seq_len, seq_len) - Softmaxåçš„æƒé‡çŸ©é˜µ<br>
                    â€¢ Value: (seq_len, d_v) - ValueçŸ©é˜µ<br>
                    â€¢ Output: (seq_len, d_v) - æœ€ç»ˆè¾“å‡ºå‘é‡
                </p>
            </div>
            
            <p class="content-text">
                <strong>æ ¸å¿ƒæ€æƒ³ï¼š</strong>æ¯ä¸ªè¾“å‡ºå‘é‡æ˜¯æ‰€æœ‰Valueå‘é‡çš„<span class="highlight">åŠ æƒå¹³å‡</span>ï¼Œ
                æƒé‡ç”±æ³¨æ„åŠ›å†³å®š
            </p>
        </div>
        
        <!-- 3. ç®€å•ç¤ºä¾‹ -->
        <div class="section">
            <h2 class="section-title">ä¸‰ã€ç®€åŒ–ç¤ºä¾‹ï¼šå•ä¸ªè¯çš„è¾“å‡º</h2>
            <p class="content-text">
                è®¡ç®—è¯"æˆ‘"çš„è¾“å‡ºå‘é‡ï¼ˆå‡è®¾æœ‰3ä¸ªè¯ï¼‰ï¼š
            </p>
            
            <div class="weighted-sum-demo">
                <div class="weight-value-pair">
                    <div class="weight-box">
                        <div class="box-label" style="color: #42a5f5;">æƒé‡1</div>
                        <div class="box-value">0.7</div>
                    </div>
                    <div class="operator-symbol">Ã—</div>
                    <div class="value-box">
                        <div class="box-label" style="color: #66bb6a;">Vâ‚</div>
                        <div class="box-value">[0.5, 0.3, 0.8]</div>
                    </div>
                    <div class="operator-symbol">=</div>
                    <div class="result-box">
                        <div class="box-value">[0.35, 0.21, 0.56]</div>
                    </div>
                </div>
                
                <div class="weight-value-pair">
                    <div class="weight-box">
                        <div class="box-label" style="color: #42a5f5;">æƒé‡2</div>
                        <div class="box-value">0.2</div>
                    </div>
                    <div class="operator-symbol">Ã—</div>
                    <div class="value-box">
                        <div class="box-label" style="color: #66bb6a;">Vâ‚‚</div>
                        <div class="box-value">[0.2, 0.7, 0.4]</div>
                    </div>
                    <div class="operator-symbol">=</div>
                    <div class="result-box">
                        <div class="box-value">[0.04, 0.14, 0.08]</div>
                    </div>
                </div>
                
                <div class="weight-value-pair">
                    <div class="weight-box">
                        <div class="box-label" style="color: #42a5f5;">æƒé‡3</div>
                        <div class="box-value">0.1</div>
                    </div>
                    <div class="operator-symbol">Ã—</div>
                    <div class="value-box">
                        <div class="box-label" style="color: #66bb6a;">Vâ‚ƒ</div>
                        <div class="box-value">[0.6, 0.1, 0.9]</div>
                    </div>
                    <div class="operator-symbol">=</div>
                    <div class="result-box">
                        <div class="box-value">[0.06, 0.01, 0.09]</div>
                    </div>
                </div>
                
                <div style="text-align: center; margin-top: 20px;">
                    <div class="operator-symbol" style="font-size: 1.5em;">â¬‡ æ±‚å’Œ</div>
                    <div class="result-box" style="display: inline-block; margin-top: 15px; padding: 25px 40px;">
                        <div class="box-label" style="color: #ef6c00; font-size: 1.3em;">æœ€ç»ˆè¾“å‡º</div>
                        <div class="box-value" style="font-size: 1.4em;">[0.45, 0.36, 0.73]</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 4. çŸ©é˜µè¿ç®—è¯¦è§£ -->
        <div class="section">
            <h2 class="section-title">å››ã€å®Œæ•´çŸ©é˜µè¿ç®—</h2>
            
            <div class="calculation-steps">
                <div class="calc-header">ğŸ§® å¥å­"æˆ‘çˆ±AI"çš„å®Œæ•´è®¡ç®—</div>
                
                <div class="calc-step">
                    <div class="step-title">è¾“å…¥ï¼šæ³¨æ„åŠ›æƒé‡çŸ©é˜µï¼ˆ3Ã—3ï¼‰</div>
                    <div class="step-content">
                        <pre style="font-family: 'Courier New'; color: #2e7d32;">
     æˆ‘    çˆ±    AI
æˆ‘ [0.7  0.2  0.1]
çˆ± [0.3  0.5  0.2]
AI [0.1  0.3  0.6]
                        </pre>
                    </div>
                </div>
                
                <div class="calc-step">
                    <div class="step-title">è¾“å…¥ï¼šValueçŸ©é˜µï¼ˆ3Ã—4ï¼‰</div>
                    <div class="step-content">
                        <pre style="font-family: 'Courier New'; color: #2e7d32;">
    dâ‚   dâ‚‚   dâ‚ƒ   dâ‚„
æˆ‘ [0.5  0.3  0.8  0.1]
çˆ± [0.2  0.7  0.4  0.6]
AI [0.6  0.1  0.9  0.3]
                        </pre>
                    </div>
                </div>
                
                <div class="calc-step">
                    <div class="step-title">çŸ©é˜µä¹˜æ³•</div>
                    <div class="step-content">
                        <strong>è®¡ç®—"æˆ‘"çš„è¾“å‡ºï¼š</strong><br>
                        [0.7, 0.2, 0.1] Ã— VçŸ©é˜µ = <br>
                        0.7Ã—[0.5,0.3,0.8,0.1] + 0.2Ã—[0.2,0.7,0.4,0.6] + 0.1Ã—[0.6,0.1,0.9,0.3]<br>
                        = [0.35+0.04+0.06, 0.21+0.14+0.01, 0.56+0.08+0.09, 0.07+0.12+0.03]<br>
                        = <strong style="color: #2e7d32;">[0.45, 0.36, 0.73, 0.22]</strong>
                    </div>
                </div>
                
                <div class="calc-step">
                    <div class="step-title">è¾“å‡ºï¼šèåˆåçš„å‘é‡ï¼ˆ3Ã—4ï¼‰</div>
                    <div class="step-content">
                        <pre style="font-family: 'Courier New'; color: #2e7d32;">
    dâ‚   dâ‚‚   dâ‚ƒ   dâ‚„
æˆ‘ [0.45 0.36 0.73 0.22]  â† èåˆäº†3ä¸ªè¯çš„ä¿¡æ¯
çˆ± [0.38 0.44 0.66 0.31]  â† èåˆäº†3ä¸ªè¯çš„ä¿¡æ¯
AI [0.42 0.40 0.75 0.42]  â† èåˆäº†3ä¸ªè¯çš„ä¿¡æ¯
                        </pre>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 5. ä¿¡æ¯èåˆå¯è§†åŒ– -->
        <div class="section">
            <h2 class="section-title">äº”ã€ä¿¡æ¯èåˆè¿‡ç¨‹</h2>
            <p class="content-text">
                æ¯ä¸ªè¾“å‡ºå‘é‡éƒ½èåˆäº†<span class="highlight">ä¸Šä¸‹æ–‡ä¸­æ‰€æœ‰è¯</span>çš„ä¿¡æ¯ï¼š
            </p>
            
            <div class="vector-visual">
                <div class="vector-card">
                    <div class="vector-label">åŸå§‹"æˆ‘"çš„Value</div>
                    <div class="vector-grid">
                        <div class="vector-cell">0.5</div>
                        <div class="vector-cell">0.3</div>
                        <div class="vector-cell">0.8</div>
                        <div class="vector-cell">0.1</div>
                    </div>
                    <div style="text-align: center; margin-top: 10px; color: #666; font-size: 0.9em;">
                        åªåŒ…å«"æˆ‘"çš„ä¿¡æ¯
                    </div>
                </div>
                
                <div class="vector-card">
                    <div class="vector-label">èåˆå"æˆ‘"çš„è¾“å‡º</div>
                    <div class="vector-grid">
                        <div class="vector-cell" style="background: linear-gradient(135deg, #ff9800, #ef6c00);">0.45</div>
                        <div class="vector-cell" style="background: linear-gradient(135deg, #ff9800, #ef6c00);">0.36</div>
                        <div class="vector-cell" style="background: linear-gradient(135deg, #ff9800, #ef6c00);">0.73</div>
                        <div class="vector-cell" style="background: linear-gradient(135deg, #ff9800, #ef6c00);">0.22</div>
                    </div>
                    <div style="text-align: center; margin-top: 10px; color: #ef6c00; font-size: 0.9em; font-weight: bold;">
                        åŒ…å«"æˆ‘""çˆ±""AI"çš„ä¿¡æ¯
                    </div>
                </div>
            </div>
            
            <p class="content-text" style="margin-top: 25px;">
                <strong>å…³é”®ç†è§£ï¼š</strong><br>
                â€¢ æƒé‡é«˜çš„è¯å¯¹è¾“å‡ºå½±å“å¤§<br>
                â€¢ æ¯ä¸ªè¾“å‡ºéƒ½è€ƒè™‘äº†æ•´ä¸ªå¥å­çš„ä¸Šä¸‹æ–‡<br>
                â€¢ å®ç°äº†è¯ä¸è¯ä¹‹é—´çš„ä¿¡æ¯äº¤äº’
            </p>
        </div>
        
        <!-- 6. å®Œæ•´è‡ªæ³¨æ„åŠ›æµç¨‹ -->
        <div class="section">
            <h2 class="section-title">å…­ã€è‡ªæ³¨æ„åŠ›å®Œæ•´æµç¨‹å›é¡¾</h2>
            
            <div class="process-flow">
                <div class="flow-step">
                    <span class="flow-number">1</span>
                    <span class="flow-title">ç”ŸæˆQã€Kã€V</span>
                    <div class="flow-desc">
                        é€šè¿‡ä¸‰ä¸ªæƒé‡çŸ©é˜µï¼Œå°†è¾“å…¥è½¬æ¢ä¸ºQueryã€Keyã€Value
                    </div>
                </div>
                
                <div class="flow-step">
                    <span class="flow-number">2</span>
                    <span class="flow-title">è®¡ç®—æ³¨æ„åŠ›åˆ†æ•°</span>
                    <div class="flow-desc">
                        Score = Q Ã— K^T / âˆšd_kï¼Œå¾—åˆ°ç›¸ä¼¼åº¦çŸ©é˜µ
                    </div>
                </div>
                
                <div class="flow-step">
                    <span class="flow-number">3</span>
                    <span class="flow-title">Softmaxå½’ä¸€åŒ–</span>
                    <div class="flow-desc">
                        å°†åˆ†æ•°è½¬æ¢ä¸ºæ¦‚ç‡åˆ†å¸ƒï¼ˆæ³¨æ„åŠ›æƒé‡ï¼‰
                    </div>
                </div>
                
                <div class="flow-step" style="border-color: #ef6c00; border-width: 3px;">
                    <span class="flow-number">4</span>
                    <span class="flow-title">åŠ æƒæ±‚å’Œï¼ˆå½“å‰æ­¥éª¤ï¼‰</span>
                    <div class="flow-desc">
                        Output = Weights Ã— Vï¼Œç”¨æ³¨æ„åŠ›æƒé‡å¯¹ValueåŠ æƒå¹³å‡
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 7. ç»´åº¦å˜åŒ– -->
        <div class="section">
            <h2 class="section-title">ä¸ƒã€ç»´åº¦å˜åŒ–åˆ†æ</h2>
            
            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>çŸ©é˜µ</th>
                        <th>å½¢çŠ¶</th>
                        <th>è¯´æ˜</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>æ³¨æ„åŠ›æƒé‡</strong></td>
                        <td>(seq_len, seq_len)</td>
                        <td>ä¾‹ï¼š(10, 10) - æ¯è¯å¯¹æ¯è¯çš„æƒé‡</td>
                    </tr>
                    <tr>
                        <td><strong>ValueçŸ©é˜µ</strong></td>
                        <td>(seq_len, d_v)</td>
                        <td>ä¾‹ï¼š(10, 64) - 10ä¸ªè¯çš„Valueå‘é‡</td>
                    </tr>
                    <tr>
                        <td><strong>è¾“å‡º</strong></td>
                        <td>(seq_len, d_v)</td>
                        <td>ä¾‹ï¼š(10, 64) - èåˆä¸Šä¸‹æ–‡åçš„å‘é‡</td>
                    </tr>
                </tbody>
            </table>
            
            <div class="tip-box">
                <div class="tip-title">ğŸ“Œ å…³é”®ç‚¹</div>
                <div class="tip-content">
                    â€¢ è¾“å‡ºç»´åº¦ä¸Valueç»´åº¦ç›¸åŒ<br>
                    â€¢ åºåˆ—é•¿åº¦ä¿æŒä¸å˜<br>
                    â€¢ æ¯ä¸ªè¾“å‡ºå‘é‡èåˆäº†æ‰€æœ‰ä½ç½®çš„ä¿¡æ¯<br>
                    â€¢ è¿™å°±æ˜¯"æ³¨æ„åŠ›"æœºåˆ¶çš„æ ¸å¿ƒï¼šé€‰æ‹©æ€§åœ°èšåˆä¿¡æ¯
                </div>
            </div>
        </div>
        
        <!-- 8. ä»£ç å®ç° -->
        <div class="section">
            <h2 class="section-title">å…«ã€PyTorchä»£ç å®ç°</h2>
            
            <div class="code-block">
<span style="color: #82b1ff;">import</span> torch

<span style="color: #82b1ff;">def</span> <span style="color: #ffb74d;">attention_weighted_sum</span>(attention_weights, V):
    <span style="color: #90a4ae;">"""
    è®¡ç®—æ³¨æ„åŠ›åŠ æƒæ±‚å’Œ
    Args:
        attention_weights: æ³¨æ„åŠ›æƒé‡, shape (batch, seq_len, seq_len)
        V: ValueçŸ©é˜µ, shape (batch, seq_len, d_v)
    Returns:
        output: åŠ æƒæ±‚å’Œç»“æœ, shape (batch, seq_len, d_v)
    """</span>
    
    <span style="color: #90a4ae;"># çŸ©é˜µä¹˜æ³•ï¼š(batch, seq_len, seq_len) Ã— (batch, seq_len, d_v)</span>
    <span style="color: #90a4ae;">#          = (batch, seq_len, d_v)</span>
    output = torch.matmul(attention_weights, V)
    
    <span style="color: #82b1ff;">return</span> output

<span style="color: #90a4ae;"># å®Œæ•´çš„è‡ªæ³¨æ„åŠ›å®ç°</span>
<span style="color: #82b1ff;">def</span> <span style="color: #ffb74d;">self_attention</span>(Q, K, V):
    <span style="color: #90a4ae;">"""å®Œæ•´çš„è‡ªæ³¨æ„åŠ›æœºåˆ¶"""</span>
    d_k = Q.size(-1)
    
    <span style="color: #90a4ae;"># 1. è®¡ç®—æ³¨æ„åŠ›åˆ†æ•°</span>
    scores = torch.matmul(Q, K.transpose(-2, -1)) / torch.sqrt(torch.tensor(d_k, dtype=torch.float32))
    
    <span style="color: #90a4ae;"># 2. Softmaxå½’ä¸€åŒ–</span>
    attention_weights = torch.softmax(scores, dim=-1)
    
    <span style="color: #90a4ae;"># 3. åŠ æƒæ±‚å’Œ</span>
    output = torch.matmul(attention_weights, V)
    
    <span style="color: #82b1ff;">return</span> output, attention_weights

<span style="color: #90a4ae;"># ä½¿ç”¨ç¤ºä¾‹</span>
batch_size = 2
seq_len = 10
d_k = d_v = 64

Q = torch.randn(batch_size, seq_len, d_k)
K = torch.randn(batch_size, seq_len, d_k)
V = torch.randn(batch_size, seq_len, d_v)

<span style="color: #90a4ae;"># è®¡ç®—è‡ªæ³¨æ„åŠ›</span>
output, weights = self_attention(Q, K, V)

<span style="color: #82b1ff;">print</span>(<span style="color: #aed581;">f"Q shape: {Q.shape}"</span>)
<span style="color: #82b1ff;">print</span>(<span style="color: #aed581;">f"K shape: {K.shape}"</span>)
<span style="color: #82b1ff;">print</span>(<span style="color: #aed581;">f"V shape: {V.shape}"</span>)
<span style="color: #82b1ff;">print</span>(<span style="color: #aed581;">f"æ³¨æ„åŠ›æƒé‡ shape: {weights.shape}"</span>)
<span style="color: #82b1ff;">print</span>(<span style="color: #aed581;">f"è¾“å‡º shape: {output.shape}"</span>)
            </div>
        </div>
        
        <!-- æ€»ç»“ -->
        <div style="background: linear-gradient(135deg, #fff3e0, #ffe0b2); padding: 30px; border-radius: 15px; margin-top: 40px;">
            <h3 style="color: #ef6c00; text-align: center; margin-bottom: 20px; font-size: 1.5em;">
                âœ¨ æ ¸å¿ƒè¦ç‚¹æ€»ç»“
            </h3>
            <div style="color: #555; line-height: 2; font-size: 1.05em;">
                âœ“ åŠ æƒæ±‚å’Œæ˜¯è‡ªæ³¨æ„åŠ›çš„æœ€åä¸€æ­¥ï¼Œå®ç°ä¿¡æ¯èåˆ<br>
                âœ“ ä½¿ç”¨æ³¨æ„åŠ›æƒé‡å¯¹æ‰€æœ‰Valueå‘é‡è¿›è¡ŒåŠ æƒå¹³å‡<br>
                âœ“ æ¯ä¸ªè¾“å‡ºå‘é‡éƒ½åŒ…å«äº†ä¸Šä¸‹æ–‡ä¸­æ‰€æœ‰è¯çš„ä¿¡æ¯<br>
                âœ“ æƒé‡è¶Šå¤§çš„è¯ï¼Œå¯¹è¾“å‡ºçš„è´¡çŒ®è¶Šå¤§<br>
                âœ“ è¾“å‡ºç»´åº¦ä¸Valueç»´åº¦ç›¸åŒï¼Œåºåˆ—é•¿åº¦ä¿æŒä¸å˜
            </div>
        </div>
        
        <div style="text-align: center; margin-top: 30px; color: #999; font-size: 0.9em;">
            <p>Â© 2025 æ³¨æ„åŠ›åŠ æƒæ±‚å’Œè¯¦è§£ - Transformerç³»åˆ—æ•™ç¨‹</p>
        </div>
    </div>
</body>
</html>