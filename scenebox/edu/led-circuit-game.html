<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LEDç”µè·¯æ­å»ºå°æ¸¸æˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            overflow-x: auto;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            color: white;
            text-align: center;
            padding: 20px;
        }
        
        .header h1 {
            font-size: 2.2em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .game-area {
            display: flex;
            min-height: 600px;
        }
        
        .components-panel {
            width: 250px;
            background: linear-gradient(135deg, #ffeaa7, #fab1a0);
            padding: 20px;
            border-right: 3px solid #ddd;
        }
        
        .components-panel h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            text-align: center;
            font-size: 1.2em;
        }
        
        .component {
            width: 80px;
            height: 60px;
            margin: 10px auto;
            border: 2px solid #333;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: grab;
            font-size: 12px;
            font-weight: bold;
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .component:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        .component:active {
            cursor: grabbing;
        }
        
        .battery {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            color: white;
        }
        
        .battery::after {
            content: '+';
            position: absolute;
            right: -8px;
            top: 50%;
            transform: translateY(-50%);
            background: #a93226;
            width: 6px;
            height: 20px;
            border-radius: 2px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
        }
        
        .resistor {
            background: linear-gradient(45deg, #f39c12, #e67e22);
            color: white;
        }
        
        .resistor::before {
            content: '';
            position: absolute;
            width: 60%;
            height: 4px;
            background: repeating-linear-gradient(
                90deg,
                #d35400 0px,
                #d35400 4px,
                #e67e22 4px,
                #e67e22 8px
            );
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        
        .led {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
            border-radius: 50%;
        }
        
        .led::after {
            content: '';
            position: absolute;
            width: 0;
            height: 0;
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            border-bottom: 12px solid #2980b9;
            top: -6px;
            left: 50%;
            transform: translateX(-50%);
        }
        
        .light-sensor {
            background: linear-gradient(45deg, #9b59b6, #8e44ad);
            color: white;
        }
        
        .light-sensor::before {
            content: 'â˜€';
            position: absolute;
            font-size: 16px;
            color: #f1c40f;
        }
        
        .controller {
            background: linear-gradient(45deg, #27ae60, #229954);
            color: white;
        }
        
        .controller::before {
            content: 'âš™';
            position: absolute;
            font-size: 16px;
        }
        
        .switch {
            background: linear-gradient(45deg, #95a5a6, #7f8c8d);
            color: white;
        }
        
        .workspace {
            flex: 1;
            background: #2c3e50;
            position: relative;
            overflow: hidden;
        }
        
        .grid {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0.1;
            background-image: 
                linear-gradient(rgba(255,255,255,0.3) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255,255,255,0.3) 1px, transparent 1px);
            background-size: 20px 20px;
        }
        
        .dropped-component {
            position: absolute;
            width: 80px;
            height: 60px;
            border: 2px solid #333;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            text-align: center;
            cursor: move;
            z-index: 10;
        }
        
        .connection-point {
            position: absolute;
            width: 8px;
            height: 8px;
            background: #f39c12;
            border-radius: 50%;
            border: 2px solid #333;
            cursor: pointer;
            z-index: 20;
        }
        
        .connection-point:hover {
            background: #e67e22;
            transform: scale(1.2);
        }
        
        .wire {
            position: absolute;
            height: 3px;
            background: #f39c12;
            border-radius: 2px;
            z-index: 5;
            transition: all 0.3s ease;
        }
        
        .wire.active {
            background: #e74c3c;
            box-shadow: 0 0 10px rgba(231, 76, 60, 0.5);
        }
        
        .control-panel {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.9);
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .control-btn {
            display: block;
            width: 100%;
            padding: 8px 15px;
            margin: 5px 0;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .test-btn {
            background: #27ae60;
            color: white;
        }
        
        .test-btn:hover {
            background: #229954;
        }
        
        .clear-btn {
            background: #e74c3c;
            color: white;
        }
        
        .clear-btn:hover {
            background: #c0392b;
        }
        
        .hint-btn {
            background: #3498db;
            color: white;
        }
        
        .hint-btn:hover {
            background: #2980b9;
        }
        
        .status-panel {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.9);
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            min-width: 200px;
        }
        
        .status-item {
            margin: 5px 0;
            font-weight: bold;
        }
        
        .status-success {
            color: #27ae60;
        }
        
        .status-error {
            color: #e74c3c;
        }
        
        .status-warning {
            color: #f39c12;
        }
        
        .tutorial {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            max-width: 500px;
            text-align: center;
            z-index: 100;
        }
        
        .tutorial h3 {
            color: #2c3e50;
            margin-bottom: 15px;
        }
        
        .tutorial p {
            color: #555;
            line-height: 1.6;
            margin-bottom: 15px;
        }
        
        .tutorial button {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }
        
        .tutorial button:hover {
            background: #2980b9;
        }
        
        .hidden {
            display: none;
        }
        
        .challenge-panel {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(52, 152, 219, 0.9);
            color: white;
            padding: 10px 20px;
            border-radius: 10px;
            font-weight: bold;
            text-align: center;
        }
        
        @media (max-width: 768px) {
            .game-area {
                flex-direction: column;
            }
            
            .components-panel {
                width: 100%;
                border-right: none;
                border-bottom: 3px solid #ddd;
            }
            
            .workspace {
                min-height: 400px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ”§ LEDç”µè·¯æ­å»ºå°æ¸¸æˆ âš¡</h1>
            <p>æ‹–æ‹½ç”µå­å…ƒä»¶ï¼Œæ­å»ºä½ çš„ç¬¬ä¸€ä¸ªLEDç”µè·¯ï¼</p>
        </div>
        
        <div class="game-area">
            <div class="components-panel">
                <h3>ğŸ§° ç”µå­å…ƒä»¶åº“</h3>
                
                <div class="component battery" draggable="true" data-type="battery">
                    ç”µæ± <br>3V
                </div>
                
                <div class="component resistor" draggable="true" data-type="resistor">
                    ç”µé˜»<br>220Î©
                </div>
                
                <div class="component led" draggable="true" data-type="led">
                    LEDç¯
                </div>
                
                <div class="component light-sensor" draggable="true" data-type="light-sensor">
                    å…‰æ•<br>ä¼ æ„Ÿå™¨
                </div>
                
                <div class="component controller" draggable="true" data-type="controller">
                    æ§åˆ¶å™¨<br>Arduino
                </div>
                
                <div class="component switch" draggable="true" data-type="switch">
                    å¼€å…³
                </div>
                
                <div style="margin-top: 20px; padding: 10px; background: rgba(255,255,255,0.3); border-radius: 8px; font-size: 12px;">
                    <strong>ğŸ’¡ æç¤ºï¼š</strong><br>
                    æ‹–æ‹½å…ƒä»¶åˆ°å³ä¾§å·¥ä½œåŒºï¼Œç‚¹å‡»è¿æ¥ç‚¹æ¥è¿æ¥ç”µè·¯ï¼
                </div>
            </div>
            
            <div class="workspace" id="workspace">
                <div class="grid"></div>
                
                <div class="challenge-panel" id="challengePanel">
                    ğŸ¯ æŒ‘æˆ˜ï¼šæ­å»ºä¸€ä¸ªç®€å•çš„LEDç”µè·¯
                </div>
                
                <div class="control-panel">
                    <button class="control-btn test-btn" onclick="testCircuit()">ğŸ” æµ‹è¯•ç”µè·¯</button>
                    <button class="control-btn clear-btn" onclick="clearWorkspace()">ğŸ—‘ï¸ æ¸…ç©ºå·¥ä½œåŒº</button>
                    <button class="control-btn hint-btn" onclick="showHint()">ğŸ’¡ è·å–æç¤º</button>
                </div>
                
                <div class="status-panel">
                    <div class="status-item">ğŸ“Š ç”µè·¯çŠ¶æ€</div>
                    <div id="circuitStatus" class="status-item status-warning">æœªè¿æ¥</div>
                    <div class="status-item">ğŸ”‹ ç”µæºçŠ¶æ€</div>
                    <div id="powerStatus" class="status-item status-error">æ— ç”µæº</div>
                    <div class="status-item">ğŸ’¡ LEDçŠ¶æ€</div>
                    <div id="ledStatus" class="status-item status-error">æœªç‚¹äº®</div>
                </div>
            </div>
        </div>
        
        <div class="tutorial" id="tutorial">
            <h3>ğŸ® æ¸¸æˆæ•™ç¨‹</h3>
            <p>æ¬¢è¿æ¥åˆ°LEDç”µè·¯æ­å»ºå°æ¸¸æˆï¼</p>
            <p><strong>æ¸¸æˆç›®æ ‡ï¼š</strong>ä½¿ç”¨å·¦ä¾§çš„ç”µå­å…ƒä»¶æ­å»ºä¸€ä¸ªå®Œæ•´çš„LEDç”µè·¯</p>
            <p><strong>æ“ä½œæ–¹æ³•ï¼š</strong></p>
            <p>1. ä»å·¦ä¾§æ‹–æ‹½å…ƒä»¶åˆ°å³ä¾§å·¥ä½œåŒº</p>
            <p>2. ç‚¹å‡»å…ƒä»¶ä¸Šçš„è¿æ¥ç‚¹ï¼ˆæ©™è‰²åœ†ç‚¹ï¼‰æ¥è¿æ¥ç”µè·¯</p>
            <p>3. ç‚¹å‡»"æµ‹è¯•ç”µè·¯"æŒ‰é’®æ£€æŸ¥ä½ çš„ç”µè·¯æ˜¯å¦æ­£ç¡®</p>
            <p><strong>åŸºæœ¬ç”µè·¯ï¼š</strong>ç”µæ±  â†’ ç”µé˜» â†’ LED â†’ å›åˆ°ç”µæ± </p>
            <button onclick="closeTutorial()">å¼€å§‹æ¸¸æˆï¼</button>
        </div>
    </div>
    
    <script>
        // æ¸¸æˆçŠ¶æ€
        let droppedComponents = [];
        let connections = [];
        let isConnecting = false;
        let connectionStart = null;
        let currentChallenge = 'basic';
        
        // æŒ‘æˆ˜ä»»åŠ¡
        const challenges = {
            basic: {
                title: 'ğŸ¯ æŒ‘æˆ˜ï¼šæ­å»ºä¸€ä¸ªç®€å•çš„LEDç”µè·¯',
                description: 'ä½¿ç”¨ç”µæ± ã€ç”µé˜»å’ŒLEDæ­å»ºåŸºæœ¬ç”µè·¯',
                required: ['battery', 'resistor', 'led'],
                hint: 'æç¤ºï¼šç”µæ± æ­£æ â†’ ç”µé˜» â†’ LEDæ­£æï¼ŒLEDè´Ÿæ â†’ ç”µæ± è´Ÿæ'
            },
            sensor: {
                title: 'ğŸŒŸ æŒ‘æˆ˜ï¼šæ­å»ºå…‰æ§LEDç”µè·¯',
                description: 'ä½¿ç”¨å…‰æ•ä¼ æ„Ÿå™¨æ§åˆ¶LED',
                required: ['battery', 'light-sensor', 'led', 'controller'],
                hint: 'æç¤ºï¼šä¼ æ„Ÿå™¨è¿æ¥åˆ°æ§åˆ¶å™¨ï¼Œæ§åˆ¶å™¨æ§åˆ¶LEDå¼€å…³'
            },
            switch: {
                title: 'âš¡ æŒ‘æˆ˜ï¼šæ­å»ºå¼€å…³æ§åˆ¶LEDç”µè·¯',
                description: 'ä½¿ç”¨å¼€å…³æ§åˆ¶LEDçš„å¼€å…³',
                required: ['battery', 'switch', 'led'],
                hint: 'æç¤ºï¼šå¼€å…³ä¸²è”åœ¨ç”µè·¯ä¸­ï¼Œæ§åˆ¶ç”µæµé€šæ–­'
            }
        };
        
        // æ‹–æ‹½åŠŸèƒ½
        document.addEventListener('DOMContentLoaded', function() {
            const components = document.querySelectorAll('.component');
            const workspace = document.getElementById('workspace');
            
            components.forEach(component => {
                component.addEventListener('dragstart', handleDragStart);
            });
            
            workspace.addEventListener('dragover', handleDragOver);
            workspace.addEventListener('drop', handleDrop);
        });
        
        function handleDragStart(e) {
            e.dataTransfer.setData('text/plain', e.target.dataset.type);
            e.dataTransfer.setData('text/html', e.target.outerHTML);
        }
        
        function handleDragOver(e) {
            e.preventDefault();
        }
        
        function handleDrop(e) {
            e.preventDefault();
            const componentType = e.dataTransfer.getData('text/plain');
            const componentHTML = e.dataTransfer.getData('text/html');
            
            // è®¡ç®—æ”¾ç½®ä½ç½®
            const rect = e.currentTarget.getBoundingClientRect();
            const x = e.clientX - rect.left - 40; // å‡å»å…ƒä»¶å®½åº¦çš„ä¸€åŠ
            const y = e.clientY - rect.top - 30;  // å‡å»å…ƒä»¶é«˜åº¦çš„ä¸€åŠ
            
            // åˆ›å»ºæ–°çš„å…ƒä»¶
            const newComponent = document.createElement('div');
            newComponent.innerHTML = componentHTML.match(/>([^<]+)</)[1];
            newComponent.className = `dropped-component ${componentType}`;
            newComponent.style.left = x + 'px';
            newComponent.style.top = y + 'px';
            newComponent.dataset.type = componentType;
            newComponent.dataset.id = 'comp_' + Date.now();
            
            // æ·»åŠ æ ·å¼
            const originalComponent = document.querySelector(`[data-type="${componentType}"]`);
            const computedStyle = window.getComputedStyle(originalComponent);
            newComponent.style.background = computedStyle.background;
            newComponent.style.color = computedStyle.color;
            newComponent.style.borderRadius = computedStyle.borderRadius;
            
            // æ·»åŠ ä¼ªå…ƒç´ æ•ˆæœ
            if (componentType === 'battery') {
                const plus = document.createElement('div');
                plus.textContent = '+';
                plus.style.cssText = `
                    position: absolute;
                    right: -8px;
                    top: 50%;
                    transform: translateY(-50%);
                    background: #a93226;
                    width: 6px;
                    height: 20px;
                    border-radius: 2px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 10px;
                    color: white;
                `;
                newComponent.appendChild(plus);
            }
            
            // æ·»åŠ è¿æ¥ç‚¹
            addConnectionPoints(newComponent, componentType);
            
            // æ·»åŠ æ‹–æ‹½åŠŸèƒ½
            makeComponentDraggable(newComponent);
            
            e.currentTarget.appendChild(newComponent);
            droppedComponents.push({
                id: newComponent.dataset.id,
                type: componentType,
                element: newComponent,
                x: x,
                y: y
            });
            
            updateStatus();
        }
        
        function addConnectionPoints(component, type) {
            const points = getConnectionPointsForType(type);
            points.forEach((point, index) => {
                const connectionPoint = document.createElement('div');
                connectionPoint.className = 'connection-point';
                connectionPoint.style.left = point.x + 'px';
                connectionPoint.style.top = point.y + 'px';
                connectionPoint.dataset.componentId = component.dataset.id;
                connectionPoint.dataset.pointIndex = index;
                connectionPoint.addEventListener('click', handleConnectionClick);
                component.appendChild(connectionPoint);
            });
        }
        
        function getConnectionPointsForType(type) {
            switch(type) {
                case 'battery':
                    return [{x: -4, y: 26}, {x: 76, y: 26}]; // å·¦å³ä¸¤ç«¯
                case 'resistor':
                    return [{x: -4, y: 26}, {x: 76, y: 26}]; // å·¦å³ä¸¤ç«¯
                case 'led':
                    return [{x: -4, y: 26}, {x: 76, y: 26}]; // å·¦å³ä¸¤ç«¯
                case 'light-sensor':
                    return [{x: 36, y: -4}, {x: 36, y: 56}]; // ä¸Šä¸‹ä¸¤ç«¯
                case 'controller':
                    return [{x: -4, y: 15}, {x: -4, y: 41}, {x: 76, y: 15}, {x: 76, y: 41}]; // å››ä¸ªè§’
                case 'switch':
                    return [{x: -4, y: 26}, {x: 76, y: 26}]; // å·¦å³ä¸¤ç«¯
                default:
                    return [{x: -4, y: 26}, {x: 76, y: 26}];
            }
        }
        
        function makeComponentDraggable(component) {
            let isDragging = false;
            let startX, startY, initialX, initialY;
            
            component.addEventListener('mousedown', function(e) {
                if (e.target.classList.contains('connection-point')) return;
                isDragging = true;
                startX = e.clientX;
                startY = e.clientY;
                initialX = parseInt(component.style.left);
                initialY = parseInt(component.style.top);
                component.style.zIndex = '100';
            });
            
            document.addEventListener('mousemove', function(e) {
                if (!isDragging) return;
                e.preventDefault();
                const deltaX = e.clientX - startX;
                const deltaY = e.clientY - startY;
                component.style.left = (initialX + deltaX) + 'px';
                component.style.top = (initialY + deltaY) + 'px';
                updateConnections();
            });
            
            document.addEventListener('mouseup', function() {
                if (isDragging) {
                    isDragging = false;
                    component.style.zIndex = '10';
                    // æ›´æ–°ç»„ä»¶ä½ç½®æ•°æ®
                    const comp = droppedComponents.find(c => c.id === component.dataset.id);
                    if (comp) {
                        comp.x = parseInt(component.style.left);
                        comp.y = parseInt(component.style.top);
                    }
                }
            });
        }
        
        function handleConnectionClick(e) {
            e.stopPropagation();
            const point = e.target;
            
            if (!isConnecting) {
                // å¼€å§‹è¿æ¥
                isConnecting = true;
                connectionStart = point;
                point.style.background = '#e74c3c';
                point.style.transform = 'scale(1.5)';
            } else {
                // å®Œæˆè¿æ¥
                if (connectionStart !== point) {
                    createConnection(connectionStart, point);
                }
                // é‡ç½®è¿æ¥çŠ¶æ€
                resetConnectionState();
            }
        }
        
        function resetConnectionState() {
            if (connectionStart) {
                connectionStart.style.background = '#f39c12';
                connectionStart.style.transform = 'scale(1)';
            }
            isConnecting = false;
            connectionStart = null;
        }
        
        function createConnection(point1, point2) {
            const rect1 = point1.getBoundingClientRect();
            const rect2 = point2.getBoundingClientRect();
            const workspaceRect = document.getElementById('workspace').getBoundingClientRect();
            
            const x1 = rect1.left - workspaceRect.left + 4;
            const y1 = rect1.top - workspaceRect.top + 4;
            const x2 = rect2.left - workspaceRect.left + 4;
            const y2 = rect2.top - workspaceRect.top + 4;
            
            const wire = document.createElement('div');
            wire.className = 'wire';
            
            const length = Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2));
            const angle = Math.atan2(y2 - y1, x2 - x1) * 180 / Math.PI;
            
            wire.style.width = length + 'px';
            wire.style.left = x1 + 'px';
            wire.style.top = y1 + 'px';
            wire.style.transform = `rotate(${angle}deg)`;
            wire.style.transformOrigin = '0 50%';
            
            wire.dataset.point1 = point1.dataset.componentId + '_' + point1.dataset.pointIndex;
            wire.dataset.point2 = point2.dataset.componentId + '_' + point2.dataset.pointIndex;
            
            // æ·»åŠ åˆ é™¤åŠŸèƒ½
            wire.addEventListener('dblclick', function() {
                wire.remove();
                connections = connections.filter(c => c.element !== wire);
                updateStatus();
            });
            
            document.getElementById('workspace').appendChild(wire);
            
            connections.push({
                element: wire,
                point1: point1,
                point2: point2,
                component1: point1.dataset.componentId,
                component2: point2.dataset.componentId
            });
            
            updateStatus();
        }
        
        function updateConnections() {
            connections.forEach(connection => {
                const rect1 = connection.point1.getBoundingClientRect();
                const rect2 = connection.point2.getBoundingClientRect();
                const workspaceRect = document.getElementById('workspace').getBoundingClientRect();
                
                const x1 = rect1.left - workspaceRect.left + 4;
                const y1 = rect1.top - workspaceRect.top + 4;
                const x2 = rect2.left - workspaceRect.left + 4;
                const y2 = rect2.top - workspaceRect.top + 4;
                
                const length = Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2));
                const angle = Math.atan2(y2 - y1, x2 - x1) * 180 / Math.PI;
                
                connection.element.style.width = length + 'px';
                connection.element.style.left = x1 + 'px';
                connection.element.style.top = y1 + 'px';
                connection.element.style.transform = `rotate(${angle}deg)`;
            });
        }
        
        function testCircuit() {
            const result = analyzeCircuit();
            
            if (result.isComplete) {
                // ç”µè·¯å®Œæ•´ï¼Œæ˜¾ç¤ºæ•ˆæœ
                showCircuitEffect();
                setTimeout(() => {
                    alert('ğŸ‰ æ­å–œï¼ç”µè·¯æ­å»ºæˆåŠŸï¼LEDç¯äº®äº†ï¼\n\n' + result.message);
                    nextChallenge();
                }, 1000);
            } else {
                alert('âŒ ç”µè·¯ä¸å®Œæ•´ï¼\n\n' + result.message);
            }
        }
        
        function analyzeCircuit() {
            const challenge = challenges[currentChallenge];
            const requiredComponents = challenge.required;
            
            // æ£€æŸ¥æ˜¯å¦æœ‰æ‰€éœ€çš„æ‰€æœ‰ç»„ä»¶
            const presentComponents = droppedComponents.map(c => c.type);
            const missingComponents = requiredComponents.filter(req => !presentComponents.includes(req));
            
            if (missingComponents.length > 0) {
                return {
                    isComplete: false,
                    message: `ç¼ºå°‘ç»„ä»¶ï¼š${missingComponents.join(', ')}`
                };
            }
            
            // æ£€æŸ¥è¿æ¥
            if (connections.length === 0) {
                return {
                    isComplete: false,
                    message: 'è¯·è¿æ¥ç”µè·¯ä¸­çš„ç»„ä»¶ï¼'
                };
            }
            
            // ç®€åŒ–çš„ç”µè·¯åˆ†æï¼ˆåŸºæœ¬æŒ‘æˆ˜ï¼‰
            if (currentChallenge === 'basic') {
                const hasBattery = presentComponents.includes('battery');
                const hasLED = presentComponents.includes('led');
                const hasResistor = presentComponents.includes('resistor');
                
                if (hasBattery && hasLED && hasResistor && connections.length >= 2) {
                    return {
                        isComplete: true,
                        message: 'åŸºæœ¬LEDç”µè·¯æ­å»ºæˆåŠŸï¼ç”µæµä»ç”µæ± æµè¿‡ç”µé˜»å’ŒLEDï¼Œå½¢æˆå®Œæ•´å›è·¯ã€‚'
                    };
                }
            }
            
            return {
                isComplete: false,
                message: 'ç”µè·¯è¿æ¥ä¸æ­£ç¡®ï¼Œè¯·æ£€æŸ¥è¿æ¥æ–¹å¼ï¼'
            };
        }
        
        function showCircuitEffect() {
            // è®©æ‰€æœ‰è¿çº¿å˜çº¢è¡¨ç¤ºæœ‰ç”µæµ
            connections.forEach(connection => {
                connection.element.classList.add('active');
            });
            
            // è®©LEDå‘å…‰
            const ledComponents = droppedComponents.filter(c => c.type === 'led');
            ledComponents.forEach(led => {
                led.element.style.boxShadow = '0 0 20px rgba(52, 152, 219, 0.8)';
                led.element.style.background = 'radial-gradient(circle, #3498db, #2980b9)';
            });
            
            // 3ç§’åæ¢å¤
            setTimeout(() => {
                connections.forEach(connection => {
                    connection.element.classList.remove('active');
                });
                ledComponents.forEach(led => {
                    led.element.style.boxShadow = '';
                    led.element.style.background = '';
                });
            }, 3000);
        }
        
        function updateStatus() {
            const circuitStatus = document.getElementById('circuitStatus');
            const powerStatus = document.getElementById('powerStatus');
            const ledStatus = document.getElementById('ledStatus');
            
            // æ£€æŸ¥ç”µæº
            const hasBattery = droppedComponents.some(c => c.type === 'battery');
            if (hasBattery) {
                powerStatus.textContent = 'æœ‰ç”µæº';
                powerStatus.className = 'status-item status-success';
            } else {
                powerStatus.textContent = 'æ— ç”µæº';
                powerStatus.className = 'status-item status-error';
            }
            
            // æ£€æŸ¥LED
            const hasLED = droppedComponents.some(c => c.type === 'led');
            if (hasLED) {
                ledStatus.textContent = 'å·²æ”¾ç½®';
                ledStatus.className = 'status-item status-warning';
            } else {
                ledStatus.textContent = 'æœªæ”¾ç½®';
                ledStatus.className = 'status-item status-error';
            }
            
            // æ£€æŸ¥è¿æ¥
            if (connections.length > 0) {
                circuitStatus.textContent = `å·²è¿æ¥ (${connections.length}æ¡çº¿)`;
                circuitStatus.className = 'status-item status-success';
            } else {
                circuitStatus.textContent = 'æœªè¿æ¥';
                circuitStatus.className = 'status-item status-warning';
            }
        }
        
        function clearWorkspace() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºå·¥ä½œåŒºå—ï¼Ÿ')) {
                // æ¸…é™¤æ‰€æœ‰ç»„ä»¶
                droppedComponents.forEach(comp => {
                    comp.element.remove();
                });
                droppedComponents = [];
                
                // æ¸…é™¤æ‰€æœ‰è¿çº¿
                connections.forEach(conn => {
                    conn.element.remove();
                });
                connections = [];
                
                // é‡ç½®è¿æ¥çŠ¶æ€
                resetConnectionState();
                
                updateStatus();
            }
        }
        
        function showHint() {
            const challenge = challenges[currentChallenge];
            alert('ğŸ’¡ ' + challenge.hint);
        }
        
        function nextChallenge() {
            const challengeKeys = Object.keys(challenges);
            const currentIndex = challengeKeys.indexOf(currentChallenge);
            
            if (currentIndex < challengeKeys.length - 1) {
                currentChallenge = challengeKeys[currentIndex + 1];
                const challenge = challenges[currentChallenge];
                document.getElementById('challengePanel').textContent = challenge.title;
                clearWorkspace();
            } else {
                alert('ğŸ† æ­å–œï¼ä½ å·²ç»å®Œæˆäº†æ‰€æœ‰æŒ‘æˆ˜ï¼\n\nä½ å·²ç»æŒæ¡äº†åŸºæœ¬çš„ç”µè·¯æ­å»ºçŸ¥è¯†ï¼');
            }
        }
        
        function closeTutorial() {
            document.getElementById('tutorial').classList.add('hidden');
        }
        
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            updateStatus();
        });
    </script>
</body>
</html>